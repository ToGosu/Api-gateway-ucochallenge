# Configuración básica de OWASP Core Rule Set
# Esta es una configuración simplificada para desarrollo
# En producción, usar el CRS completo de OWASP

SecDefaultAction "phase:1,log,auditlog,pass"
SecDefaultAction "phase:2,log,auditlog,pass"

# Configuración de límites
SecRequestBodyLimit 13107200
SecRequestBodyNoFilesLimit 131072
SecRequestBodyLimitAction Reject

# Configuración de tipos de contenido permitidos
SecRequestBodyAccess On
SecResponseBodyAccess On
SecResponseBodyMimeType text/plain text/html text/xml application/json

# Configuración de codificación
SecArgumentSeparator &
SecCookieFormat 0

# Configuración de logs
SecAuditLogRelevantStatus "^(?:5|4(?!04))"
SecAuditLogParts ABIJDEFHZ
SecAuditLogType Serial
SecAuditLogStorageDir /var/log/nginx/modsec/

# Reglas personalizadas básicas (ejemplo)
# Bloquear intentos de SQL Injection básicos
SecRule ARGS "@detectSQLi" \
    "id:1000,\
    phase:2,\
    block,\
    msg:'Possible SQL Injection Attack',\
    logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}',\
    tag:'attack-sqli',\
    severity:'CRITICAL'"

# Bloquear intentos de XSS básicos
SecRule ARGS "@detectXSS" \
    "id:1001,\
    phase:2,\
    block,\
    msg:'Possible XSS Attack',\
    logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}',\
    tag:'attack-xss',\
    severity:'CRITICAL'"

